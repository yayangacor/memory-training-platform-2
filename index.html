<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Memory Training Platform</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --bg-primary: #0a0a0b;
            --bg-secondary: #141417;
            --bg-tertiary: #1c1c21;
            --bg-hover: #252529;
            --text-primary: #f5f5f7;
            --text-secondary: #a1a1a6;
            --text-muted: #6e6e73;
            --accent: #6366f1;
            --accent-hover: #818cf8;
            --success: #22c55e;
            --error: #ef4444;
            --warning: #f59e0b;
            --border: #2d2d32;
            --border-light: #3d3d42;
        }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.5;
        }
        #root { min-height: 100vh; }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-secondary); }
        ::-webkit-scrollbar-thumb { background: var(--border-light); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--text-muted); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        @keyframes bounceIn { 0% { transform: scale(0.9); opacity: 0; } 50% { transform: scale(1.02); } 100% { transform: scale(1); opacity: 1; } }
        .fade-in { animation: fadeIn 0.3s ease-out; }
        .shake { animation: shake 0.3s ease-in-out; }
        .bounce-in { animation: bounceIn 0.3s ease-out; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useCallback } = React;

        // ============ DATA ============
        const traineeData = [
            { tnumber: "T005", name: "Maximillian Delavega Adiwinata Frenat", jurusan: "Cyber Security", img: "/T005.png", angkatan: "B28" },
            { tnumber: "T010", name: "Marcelino Rosselo Sungkono", jurusan: "Computer Science", img: "/T010.png", angkatan: "B28" },
            { tnumber: "T022", name: "Clevant Joe Hizkia", jurusan: "Computer Science and Mathematics", img: "/T022.png", angkatan: "B29" },
            { tnumber: "T030", name: "Wu Jeremmy Iskandar", jurusan: "Data Science", img: "/T030.png", angkatan: "B29" },
            { tnumber: "T042", name: "Jason Kenneth Lay", jurusan: "Artificial Intelligence", img: "/T042.png", angkatan: "B29" },
            { tnumber: "T044", name: "Wilson Arlando", jurusan: "Computer Science and Mathematics", img: "/T044.png", angkatan: "B29" },
            { tnumber: "T054", name: "Muhammad Jibran Aulia Ramadhan", jurusan: "Data Science", img: "/T054.png", angkatan: "B29" },
            { tnumber: "T078", name: "Elbert Joan", jurusan: "Artificial Intelligence", img: "/T078.png", angkatan: "B29" },
            { tnumber: "T083", name: "Felisha Yang", jurusan: "Data Science", img: "/T083.png", angkatan: "B29" },
            { tnumber: "T088", name: "Nicholas Anthony Hernando Gan", jurusan: "Computer Science", img: "/T088.png", angkatan: "B29" },
            { tnumber: "T101", name: "Michael Arthara Immanuel", jurusan: "Artificial Intelligence", img: "/T101.png", angkatan: "B29" },
            { tnumber: "T110", name: "Alfred Abner", jurusan: "Computer Science", img: "/T110.png", angkatan: "B29" },
            { tnumber: "T113", name: "Bryan O'neill Alim", jurusan: "Computer Science", img: "/T113.png", angkatan: "B29" },
            { tnumber: "T126", name: "Evan Satyadharma Gunardi", jurusan: "Artificial Intelligence", img: "/T126.png", angkatan: "B29" },
            { tnumber: "T133", name: "Keane Wilson Prakoso", jurusan: "Computer Science", img: "/T133.png", angkatan: "B29" },
            { tnumber: "T134", name: "Archie Ricardo", jurusan: "Computer Science and Mathematics", img: "/T134.png", angkatan: "B29" },
            { tnumber: "T141", name: "Aaron Christian", jurusan: "Artificial Intelligence", img: "/T141.png", angkatan: "B29" },
            { tnumber: "T153", name: "I Wayan Sudana Dyaksa", jurusan: "Computer Science", img: "/T153.png", angkatan: "B29" },
            { tnumber: "T155", name: "Moses Joshua Lesmana", jurusan: "Computer Science (MT)", img: "/T155.png", angkatan: "B29" },
            { tnumber: "T168", name: "Nazkia Najidah Ramdani", jurusan: "Data Science", img: "/T168.png", angkatan: "B29" }
        ];

        const trainerData = {
            "25-2": [
                { name: "Gavin Justine", img: "/GJ25-2.png", initial: "GJ25-2", position: "Junior Laboratory Assistant" },
                { name: "Hans Kartawinata", img: "/HK25-2.png", initial: "HK25-2", position: "Junior Laboratory Assistant" },
                { name: "Jordan Grant", img: "/OG25-2.png", initial: "OG25-2", position: "Junior Laboratory Assistant" },
                { name: "Ryan Hazzel Chandra", img: "/RZ25-2.png", initial: "RZ25-2", position: "Junior Laboratory Assistant" }
            ],
            "25-1": [
                { name: "Nathanael Moses", img: "/ES25-1.png", initial: "ES25-1", position: "Laboratory Assistant" },
                { name: "Evorius Valens Taruna", img: "/EV25-1.png", initial: "EV25-1", position: "Laboratory Assistant" },
                { name: "Rafael Febrian", img: "/FB25-1.png", initial: "FB25-1", position: "Laboratory Assistant" },
                { name: "Daniel Regis Febrianto", img: "/GS25-1.png", initial: "GS25-1", position: "Laboratory Assistant" },
                { name: "Ivy Nikita Malvin", img: "/IV25-1.png", initial: "IV25-1", position: "Laboratory Assistant" },
                { name: "Sisilia Annabel Aileen", img: "/IL25-1.png", initial: "IL25-1", position: "Laboratory Assistant" },
                { name: "Kenneth Maximillian Pranata", img: "/MX25-1.png", initial: "MX25-1", position: "Laboratory Assistant" },
                { name: "Jonathan Christian Wongso", img: "/NG25-1.png", initial: "NG25-1", position: "Laboratory Assistant" },
                { name: "Sean Spencer", img: "/NP25-1.png", initial: "NP25-1", position: "Laboratory Assistant" },
                { name: "Alin Lorensia", img: "/OI25-1.png", initial: "OI25-1", position: "Laboratory Assistant" },
                { name: "Marcell Sutiono", img: "/RL25-1.png", initial: "RL25-1", position: "Laboratory Assistant" },
                { name: "Weneville", img: "/WE25-1.png", initial: "WE25-1", position: "Laboratory Assistant" }
            ],
            "24-2": [
                { name: "Aldric Tan", img: "/AC24-2.png", initial: "AC24-2", position: "Laboratory Assistant" },
                { name: "Helena Aurelia Sanjaya", img: "/AS24-2.png", initial: "AS24-2", position: "Operations Management Officer" },
                { name: "Brenda Calista Haryanto", img: "/BD24-2.png", initial: "BD24-2", position: "Laboratory Assistant" },
                { name: "Bertrand Geraldo Tjahyadi", img: "/BT24-2.png", initial: "BT24-2", position: "Laboratory Assistant" },
                { name: "Celine Tan", img: "/CT24-2.png", initial: "CT24-2", position: "Laboratory Assistant" },
                { name: "Fortino", img: "/FO24-2.png", initial: "FO24-2", position: "Laboratory Assistant" },
                { name: "Reinhart Gian", img: "/GN24-2.png", initial: "GN24-2", position: "Laboratory Assistant" },
                { name: "Ni Komang Gayatri Kusuma Wardhani", img: "/GY24-2.png", initial: "GY24-2", position: "Laboratory Assistant" },
                { name: "Steven Hardyanto", img: "/HO24-2.png", initial: "HO24-2", position: "Laboratory Assistant" },
                { name: "Kevin Nathanael Hendarto", img: "/KH24-2.png", initial: "KH24-2", position: "Laboratory Assistant" },
                { name: "Tommy Awada", img: "/MM24-2.png", initial: "MM24-2", position: "Laboratory Assistant" },
                { name: "Marco Linardi", img: "/MR24-2.png", initial: "MR24-2", position: "Laboratory Assistant" },
                { name: "Marvel Collin", img: "/MV24-2.png", initial: "MV24-2", position: "Research and Development Staff" },
                { name: "Agnes Faustine Ilona Soejanto", img: "/NS24-2.png", initial: "NS24-2", position: "Laboratory Assistant" },
                { name: "Octavius Sandriago", img: "/OV24-2.png", initial: "OV24-2", position: "Laboratory Assistant" },
                { name: "Paul Tsai Adinata", img: "/PL24-2.png", initial: "PL24-2", position: "Subject Coordinator Staff" },
                { name: "Ryuu Stanley Tistogondo", img: "/RU24-2.png", initial: "RU24-2", position: "Laboratory Assistant" },
                { name: "Steven Taniardi", img: "/TI24-2.png", initial: "TI24-2", position: "Laboratory Assistant" },
                { name: "Vincentius Devin Agung Oktara", img: "/VD24-2.png", initial: "VD24-2", position: "Laboratory Assistant" },
                { name: "Veron Fujimori", img: "/VM24-2.png", initial: "VM24-2", position: "Laboratory Assistant" },
                { name: "William Sebastian Liman", img: "/WS24-2.png", initial: "WS24-2", position: "Laboratory Assistant" },
                { name: "Wilsen Wiratan", img: "/WW24-2.png", initial: "WW24-2", position: "Laboratory Assistant" },
                { name: "Yudhistira", img: "/YD24-2.png", initial: "YD24-2", position: "Laboratory Assistant" }
            ],
            "24-1": [
                { name: "Christian Dexter Fernando", img: "/CF24-1.png", initial: "CF24-1", position: "Network Administrator and Technical Support Staff" },
                { name: "Jose Christian Wijaya", img: "/CW24-1.png", initial: "CW24-1", position: "Subject Coordinator Staff" },
                { name: "Gilbert Jefferson", img: "/GT24-1.png", initial: "GT24-1", position: "Subject Coordinator Staff" },
                { name: "Kenneth Andrew", img: "/KA24-1.png", initial: "KA24-1", position: "Laboratory Assistant" },
                { name: "Kevin Pramudya Mahardika", img: "/KK24-1.png", initial: "KK24-1", position: "Subject Coordinator Staff" },
                { name: "Muhammad Aryo Baskoro", img: "/KR24-1.png", initial: "KR24-1", position: "Subject Coordinator Staff" },
                { name: "Nathanael Sjaklif", img: "/LF24-1.png", initial: "LF24-1", position: "Laboratory Assistant" },
                { name: "Luciano Mathew Hinarta", img: "/LO24-1.png", initial: "LO24-1", position: "Laboratory Assistant" },
                { name: "Marvella Viana Santoso", img: "/MS24-1.png", initial: "MS24-1", position: "Subject Coordinator Staff" },
                { name: "Philip Purnama", img: "/PP24-1.png", initial: "PP24-1", position: "Laboratory Assistant" },
                { name: "Michael Stefano Irawadi", img: "/SF24-1.png", initial: "SF24-1", position: "Laboratory Assistant" },
                { name: "Steven Liementha", img: "/SV24-1.png", initial: "SV24-1", position: "Research and Development Staff" },
                { name: "Vincent", img: "/VL24-1.png", initial: "VL24-1", position: "Laboratory Assistant" },
                { name: "Vincentius Jonathan Tanujaya", img: "/VU24-1.png", initial: "VU24-1", position: "Network Administrator and Technical Support Staff" },
                { name: "Xaviero Yamin Loganta", img: "/XY24-1.png", initial: "XY24-1", position: "Laboratory Assistant" },
                { name: "Yenita Kimberly", img: "/YK24-1.png", initial: "YK24-1", position: "Subject Coordinator Staff" },
                { name: "Inner Journey Tazkie Ciputra Tangguh", img: "/ZK24-1.png", initial: "ZK24-1", position: "Database Administration Staff" }
            ],
            "23-2": [
                { name: "Adrian Yu", img: "/AY23-2.png", initial: "AY23-2", position: "Database Administration Staff" },
                { name: "Jason Daniel Tanuarta", img: "/DT23-2.png", initial: "DT23-2", position: "Research and Development Staff" },
                { name: "Frederick Yonathan Ehowu Mendrofa", img: "/FD23-2.png", initial: "FD23-2", position: "Laboratory Assistant" },
                { name: "Hendra Hendarto", img: "/HH23-2.png", initial: "HH23-2", position: "Database Administration Staff" },
                { name: "Jackson", img: "/JZ23-2.png", initial: "JZ23-2", position: "Network Administrator and Technical Support Staff" },
                { name: "William Christian", img: "/LM23-2.png", initial: "LM23-2", position: "Research and Development Staff" },
                { name: "Marvino Fransisco", img: "/MF23-2.png", initial: "MF23-2", position: "Laboratory Assistant" },
                { name: "Michael Iskandardinata", img: "/MH23-2.png", initial: "MH23-2", position: "Network Administrator and Technical Support Staff" },
                { name: "Daniel Adamlu", img: "/NL23-2.png", initial: "NL23-2", position: "Network Administrator and Technical Support Staff" },
                { name: "Jonathan Maverick", img: "/VK23-2.png", initial: "VK23-2", position: "Subject Coordinator Staff" },
                { name: "Vincent Ramaputra", img: "/VR23-2.png", initial: "VR23-2", position: "Laboratory Assistant" },
                { name: "Axel Kurniawan", img: "/XK23-2.png", initial: "XK23-2", position: "Laboratory Assistant" }
            ],
            "23-1": [
                { name: "Rico Aurelio Gunadi Sastra", img: "/IO23-1.png", initial: "IO23-1", position: "Network Administrator and Technical Support Staff" },
                { name: "Terrance Dave Phoebus", img: "/PB23-1.png", initial: "PB23-1", position: "Network Administrator and Technical Support Staff" },
                { name: "Nicholas Irvin Suhendi", img: "/IR23-1.png", initial: "IR23-1", position: "Database Administration Staff" },
                { name: "Felix Gunawan Hendy", img: "/XD23-1.png", initial: "XD23-1", position: "Network Administrator and Technical Support Staff" },
                { name: "Jovita Waisakhi", img: "/VI23-1.png", initial: "VI23-1", position: "Subject Coordinator Staff" }
            ],
            "22-2": [
                { name: "Hans Indrawan Sucipto", img: "/HI22-2.png", initial: "HI22-2", position: "Network Administrator and Technical Support Staff" },
                { name: "Valentino Setiawan", img: "/VS22-2.png", initial: "VS22-2", position: "Network Administrator and Technical Support Staff" },
                { name: "Marchel Hermanliansyah", img: "/MC22-2.png", initial: "MC22-2", position: "Network Administrator and Technical Support Officer" },
                { name: "Jason Ananda Cindra", img: "/JC22-2.png", initial: "JC22-2", position: "Laboratory Assistant" },
                { name: "Jevon Danaristo", img: "/JO22-2.png", initial: "JO22-2", position: "Network Administrator and Technical Support Staff" }
            ],
            "22-1": [
                { name: "Jeremy Loa", img: "/JM22-1.png", initial: "JM22-1", position: "Network Administrator and Technical Support Officer" },
                { name: "Renaldi Addison", img: "/RE22-1.png", initial: "RE22-1", position: "Subject Coordinator Staff" }
            ],
            "20-1": [
                { name: "Jonathan Adrian", img: "/JH20-1.png", initial: "JH20-1", position: "Operations Management Officer" }
            ],
            "19-2": [
                { name: "Louis Choules", img: "/LH19-2.png", initial: "LH19-2", position: "Laboratory Assistant" }
            ]
        };

        const subjectMapping = {
            "A&DS": ["GS", "RL", "LH", "IL", "KH", "FB", "KK", "PP", "KA", "GN", "IO", "PB", "VM", "WS", "FD", "VS", "MR", "SF"],
            "Database": ["IV", "NG", "CW", "MF", "IR", "JM", "AS", "JZ", "RE", "YD", "PB", "XD", "PP"],
            "Java": ["ES", "NP", "RU", "MM", "YK", "GT", "RL", "FO", "BT", "OI", "JH", "AY", "JO", "IV", "IL", "XK", "PP"],
            "Web Design": ["WE", "OI", "MV", "NS", "YD", "TI", "AC", "VD", "GY", "LO", "LF", "CT", "NP", "VR", "VU", "ZK"],
            "Web Programming": ["IL", "MX", "SV", "CF", "FB", "VK", "RU", "GS", "HI", "LM", "VD", "PP", "DT", "KH", "MV", "PL", "VU"],
            "Network": ["EV", "FB", "YD", "VS", "JM", "OV", "NL", "JC", "HO", "MS", "IO", "MH", "VL", "XY", "VI", "HH", "PL", "SF"]
        };

        const subjectFullNames = {
            "A&DS": "Algorithm & Data Structure",
            "Database": "Database",
            "Java": "Java Programming",
            "Web Design": "Web Design",
            "Web Programming": "Web Programming",
            "Network": "Network"
        };

        // ============ UTILITY FUNCTIONS ============
        const shuffleArray = (array) => {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        };

        const getAllTrainers = () => {
            const all = [];
            Object.entries(trainerData).forEach(([gen, trainers]) => {
                trainers.forEach(t => {
                    const initialPrefix = t.initial.replace(/[0-9-]/g, '');
                    const subjects = [];
                    Object.entries(subjectMapping).forEach(([subject, initials]) => {
                        if (initials.includes(initialPrefix)) subjects.push(subject);
                    });
                    all.push({ ...t, generation: gen, subjects });
                });
            });
            return all;
        };

        const getTrainersBySubject = (subject) => getAllTrainers().filter(t => t.subjects.includes(subject));

        const getUniquePositions = () => {
            const positions = new Set();
            getAllTrainers().forEach(t => { if (t.position) positions.add(t.position); });
            return Array.from(positions).sort();
        };

        const getUniqueJurusan = () => {
            const jurusan = new Set();
            traineeData.forEach(t => jurusan.add(t.jurusan));
            return Array.from(jurusan).sort();
        };

        const normalizeText = (text) => text.toLowerCase().trim().replace(/['']/g, "'");

        const censorInitial = (initial) => {
            const prefix = initial.substring(0, 2);
            return `${prefix}**-*`;
        };

        // ============ STYLES ============
        const styles = {
            container: { maxWidth: '600px', margin: '0 auto', padding: '16px', minHeight: '100vh' },
            header: { textAlign: 'center', padding: '24px 0', borderBottom: '1px solid var(--border)', marginBottom: '24px' },
            logo: { width: '60px', height: '60px', borderRadius: '12px', marginBottom: '12px' },
            title: { fontSize: '1.5rem', fontWeight: '700', marginBottom: '4px', fontFamily: "'JetBrains Mono', monospace" },
            subtitle: { color: 'var(--text-secondary)', fontSize: '0.875rem' },
            card: { background: 'var(--bg-secondary)', borderRadius: '12px', padding: '20px', marginBottom: '16px', border: '1px solid var(--border)' },
            button: { width: '100%', padding: '14px 20px', borderRadius: '10px', border: 'none', background: 'var(--bg-tertiary)', color: 'var(--text-primary)', fontSize: '0.9375rem', fontWeight: '500', cursor: 'pointer', transition: 'all 0.2s ease', display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '8px' },
            buttonPrimary: { background: 'var(--accent)', color: 'white' },
            input: { width: '100%', padding: '14px 16px', borderRadius: '10px', border: '1px solid var(--border)', background: 'var(--bg-tertiary)', color: 'var(--text-primary)', fontSize: '1rem', outline: 'none', transition: 'border-color 0.2s ease' },
            inputSmall: { width: '50px', padding: '10px 8px', borderRadius: '8px', border: '1px solid var(--border)', background: 'var(--bg-tertiary)', color: 'var(--text-primary)', fontSize: '1rem', outline: 'none', textAlign: 'center', fontFamily: "'JetBrains Mono', monospace" },
            select: { width: '100%', padding: '14px 16px', borderRadius: '10px', border: '1px solid var(--border)', background: 'var(--bg-tertiary)', color: 'var(--text-primary)', fontSize: '0.9375rem', outline: 'none', cursor: 'pointer', appearance: 'none', backgroundImage: `url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23a1a1a6' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E")`, backgroundRepeat: 'no-repeat', backgroundPosition: 'right 12px center', backgroundSize: '20px' },
            personImage: { width: '180px', height: '180px', borderRadius: '16px', objectFit: 'cover', margin: '0 auto 20px', display: 'block', border: '3px solid var(--border)' },
            tag: { display: 'inline-block', padding: '4px 10px', borderRadius: '6px', fontSize: '0.75rem', fontWeight: '500', background: 'var(--bg-tertiary)', color: 'var(--text-secondary)', marginRight: '6px', marginBottom: '6px' },
            tagSubject: { display: 'inline-block', padding: '4px 10px', borderRadius: '6px', fontSize: '0.7rem', fontWeight: '500', background: 'rgba(99, 102, 241, 0.2)', color: 'var(--accent-hover)', marginRight: '4px', marginBottom: '4px' },
            progressBar: { width: '100%', height: '6px', background: 'var(--bg-tertiary)', borderRadius: '3px', overflow: 'hidden', marginBottom: '8px' },
            progressFill: { height: '100%', background: 'var(--accent)', transition: 'width 0.3s ease' },
            scoreDisplay: { display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '12px 16px', background: 'var(--bg-tertiary)', borderRadius: '10px', marginBottom: '16px' },
            hintButton: { padding: '8px 16px', borderRadius: '8px', border: '1px solid var(--border)', background: 'transparent', color: 'var(--text-secondary)', fontSize: '0.8125rem', cursor: 'pointer', transition: 'all 0.2s ease' },
            hintText: { padding: '12px 16px', background: 'var(--bg-tertiary)', borderRadius: '8px', marginTop: '12px', fontSize: '0.875rem', color: 'var(--warning)', fontFamily: "'JetBrains Mono', monospace" },
            backButton: { display: 'flex', alignItems: 'center', gap: '8px', padding: '10px 16px', borderRadius: '8px', border: 'none', background: 'transparent', color: 'var(--text-secondary)', fontSize: '0.875rem', cursor: 'pointer', marginBottom: '16px' },
            resultCard: { textAlign: 'center', padding: '32px 20px' },
            resultIcon: { fontSize: '4rem', marginBottom: '16px' },
            optionButton: { width: '100%', padding: '14px', borderRadius: '10px', border: '1px solid var(--border)', background: 'var(--bg-tertiary)', color: 'var(--text-primary)', fontSize: '0.875rem', cursor: 'pointer', transition: 'all 0.2s ease', marginBottom: '8px', textAlign: 'left', display: 'flex', alignItems: 'center' },
            grid: { display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '12px' },
            grid3: { display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: '8px' },
            sectionLabel: { fontSize: '0.8125rem', fontWeight: '600', color: 'var(--text-muted)', marginBottom: '10px', textTransform: 'uppercase', letterSpacing: '0.5px' },
            divider: { height: '1px', background: 'var(--border)', margin: '16px 0' },
            feedbackItem: { display: 'flex', alignItems: 'center', gap: '8px', padding: '8px 12px', borderRadius: '6px', marginBottom: '6px', fontSize: '0.875rem' },
        };

        // ============ COMPONENTS ============
        
        const HomeScreen = ({ onSelectMode }) => (
            <div style={styles.container} className="fade-in">
                <div style={styles.header}>
                    <img src="/Logokita.png" alt="Logo" style={styles.logo} />
                    <h1 style={styles.title}>Memory Training</h1>
                    <p style={styles.subtitle}>Learn and remember names efficiently</p>
                </div>
                <div style={styles.card}>
                    <h2 style={{ fontSize: '1.125rem', marginBottom: '16px', fontWeight: '600' }}>üë• Trainee Mode</h2>
                    <p style={{ color: 'var(--text-secondary)', fontSize: '0.875rem', marginBottom: '16px' }}>{traineeData.length} trainees from B28 & B29</p>
                    <button style={{ ...styles.button, ...styles.buttonPrimary }} onClick={() => onSelectMode('trainee')}>Start Training <span>‚Üí</span></button>
                </div>
                <div style={styles.card}>
                    <h2 style={{ fontSize: '1.125rem', marginBottom: '16px', fontWeight: '600' }}>üéì Trainer Mode</h2>
                    <p style={{ color: 'var(--text-secondary)', fontSize: '0.875rem', marginBottom: '16px' }}>{getAllTrainers().length} trainers from Gen 19-2 to 25-2</p>
                    <button style={{ ...styles.button, ...styles.buttonPrimary }} onClick={() => onSelectMode('trainer')}>Start Training <span>‚Üí</span></button>
                </div>
                <div style={{ textAlign: 'center', marginTop: '24px', color: 'var(--text-muted)', fontSize: '0.75rem' }}><p>Built with ‚ù§Ô∏è for better memory</p></div>
            </div>
        );

        const TraineeSetupScreen = ({ onBack, onStart }) => {
            const [filter, setFilter] = useState('all');
            const [mode, setMode] = useState('multiple');
            const jurusanList = getUniqueJurusan();
            const filteredCount = useMemo(() => filter === 'all' ? traineeData.length : traineeData.filter(t => t.jurusan === filter).length, [filter]);

            return (
                <div style={styles.container} className="fade-in">
                    <button style={styles.backButton} onClick={onBack}>‚Üê Back to Home</button>
                    <div style={styles.card}>
                        <h2 style={{ fontSize: '1.125rem', marginBottom: '20px', fontWeight: '600' }}>üë• Trainee Training Setup</h2>
                        <div style={{ marginBottom: '20px' }}>
                            <label style={{ display: 'block', marginBottom: '8px', color: 'var(--text-secondary)', fontSize: '0.875rem' }}>Filter by Major</label>
                            <select style={styles.select} value={filter} onChange={(e) => setFilter(e.target.value)}>
                                <option value="all">All Majors ({traineeData.length})</option>
                                {jurusanList.map(j => <option key={j} value={j}>{j} ({traineeData.filter(t => t.jurusan === j).length})</option>)}
                            </select>
                        </div>
                        <div style={{ marginBottom: '20px' }}>
                            <label style={{ display: 'block', marginBottom: '8px', color: 'var(--text-secondary)', fontSize: '0.875rem' }}>Quiz Mode</label>
                            <div style={styles.grid}>
                                {[{ id: 'multiple', label: 'Multiple Choice', desc: 'Pick from 4 options' }, { id: 'spelling', label: 'Spelling Mode', desc: 'Type full name' }].map(m => (
                                    <button key={m.id} style={{ ...styles.optionButton, flexDirection: 'column', alignItems: 'flex-start', borderColor: mode === m.id ? 'var(--accent)' : 'var(--border)', background: mode === m.id ? 'rgba(99, 102, 241, 0.1)' : 'var(--bg-tertiary)' }} onClick={() => setMode(m.id)}>
                                        <div style={{ fontWeight: '500' }}>{m.label}</div>
                                        <div style={{ fontSize: '0.75rem', color: 'var(--text-muted)', marginTop: '4px' }}>{m.desc}</div>
                                    </button>
                                ))}
                            </div>
                        </div>
                        <div style={{ padding: '12px', background: 'var(--bg-tertiary)', borderRadius: '8px', marginBottom: '20px' }}><p style={{ fontSize: '0.875rem', color: 'var(--text-secondary)' }}>üìä {filteredCount} trainees selected</p></div>
                        <button style={{ ...styles.button, ...styles.buttonPrimary }} onClick={() => onStart({ filter, mode })} disabled={filteredCount === 0}>Start Quiz <span>‚Üí</span></button>
                    </div>
                </div>
            );
        };

        const TrainerSetupScreen = ({ onBack, onStart }) => {
            const [filter, setFilter] = useState('all');
            const [filterType, setFilterType] = useState('generation');
            const [mode, setMode] = useState('multiple');
            
            const generations = Object.keys(trainerData).sort((a, b) => { const [aY, aS] = a.split('-').map(Number); const [bY, bS] = b.split('-').map(Number); return bY - aY || bS - aS; });
            const positions = getUniquePositions();
            const subjects = Object.keys(subjectMapping);

            const filteredTrainers = useMemo(() => {
                const all = getAllTrainers();
                if (filter === 'all') return all;
                if (filterType === 'generation') return all.filter(t => t.generation === filter);
                if (filterType === 'position') return all.filter(t => t.position === filter);
                if (filterType === 'subject') return all.filter(t => t.subjects.includes(filter));
                return all;
            }, [filter, filterType]);

            return (
                <div style={styles.container} className="fade-in">
                    <button style={styles.backButton} onClick={onBack}>‚Üê Back to Home</button>
                    <div style={styles.card}>
                        <h2 style={{ fontSize: '1.125rem', marginBottom: '20px', fontWeight: '600' }}>üéì Trainer Training Setup</h2>
                        <div style={{ marginBottom: '20px' }}>
                            <label style={{ display: 'block', marginBottom: '8px', color: 'var(--text-secondary)', fontSize: '0.875rem' }}>Filter Type</label>
                            <div style={styles.grid3}>
                                {['generation', 'position', 'subject'].map(ft => (
                                    <button key={ft} style={{ ...styles.optionButton, justifyContent: 'center', borderColor: filterType === ft ? 'var(--accent)' : 'var(--border)', background: filterType === ft ? 'rgba(99, 102, 241, 0.1)' : 'var(--bg-tertiary)', marginBottom: 0 }} onClick={() => { setFilterType(ft); setFilter('all'); }}>
                                        {ft.charAt(0).toUpperCase() + ft.slice(1)}
                                    </button>
                                ))}
                            </div>
                        </div>
                        <div style={{ marginBottom: '20px' }}>
                            <label style={{ display: 'block', marginBottom: '8px', color: 'var(--text-secondary)', fontSize: '0.875rem' }}>
                                {filterType === 'generation' ? 'Select Generation' : filterType === 'position' ? 'Select Position' : 'Select Subject'}
                            </label>
                            <select style={styles.select} value={filter} onChange={(e) => setFilter(e.target.value)}>
                                <option value="all">All ({getAllTrainers().length})</option>
                                {filterType === 'generation' && generations.map(g => <option key={g} value={g}>Gen {g} ({trainerData[g].length})</option>)}
                                {filterType === 'position' && positions.map(p => <option key={p} value={p}>{p} ({getAllTrainers().filter(t => t.position === p).length})</option>)}
                                {filterType === 'subject' && subjects.map(s => <option key={s} value={s}>{subjectFullNames[s]} ({getTrainersBySubject(s).length})</option>)}
                            </select>
                        </div>
                        <div style={{ marginBottom: '20px' }}>
                            <label style={{ display: 'block', marginBottom: '8px', color: 'var(--text-secondary)', fontSize: '0.875rem' }}>Quiz Mode</label>
                            <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                                {[
                                    { id: 'multiple', label: 'Multiple Choice', desc: 'Pick name from 4 options' },
                                    { id: 'spelling', label: 'Spelling + Position', desc: 'Type name & guess position' },
                                    { id: 'hard', label: 'üî• Hard Mode', desc: 'Name + Position + Generation' },
                                    { id: 'subject', label: 'Guess Subject', desc: 'Pick subject from options' },
                                ].map(m => (
                                    <button key={m.id} style={{ ...styles.optionButton, flexDirection: 'column', alignItems: 'flex-start', borderColor: mode === m.id ? 'var(--accent)' : 'var(--border)', background: mode === m.id ? 'rgba(99, 102, 241, 0.1)' : 'var(--bg-tertiary)', marginBottom: 0 }} onClick={() => setMode(m.id)}>
                                        <div style={{ fontWeight: '500' }}>{m.label}</div>
                                        <div style={{ fontSize: '0.75rem', color: 'var(--text-muted)', marginTop: '4px' }}>{m.desc}</div>
                                    </button>
                                ))}
                            </div>
                        </div>
                        <div style={{ padding: '12px', background: 'var(--bg-tertiary)', borderRadius: '8px', marginBottom: '20px' }}><p style={{ fontSize: '0.875rem', color: 'var(--text-secondary)' }}>üìä {filteredTrainers.length} trainers selected</p></div>
                        <button style={{ ...styles.button, ...styles.buttonPrimary }} onClick={() => onStart({ filter, filterType, mode })} disabled={filteredTrainers.length === 0}>Start Quiz <span>‚Üí</span></button>
                    </div>
                </div>
            );
        };

        const QuizScreen = ({ type, config, onBack, onComplete }) => {
            const [questions, setQuestions] = useState([]);
            const [currentIndex, setCurrentIndex] = useState(0);
            const [score, setScore] = useState(0);
            const [answered, setAnswered] = useState(false);
            const [selectedAnswer, setSelectedAnswer] = useState(null);
            const [textAnswer, setTextAnswer] = useState('');
            const [showHint, setShowHint] = useState(false);
            const [hintLevel, setHintLevel] = useState(0);
            const [progress, setProgress] = useState([]);
            
            // For spelling + position mode
            const [selectedPosition, setSelectedPosition] = useState(null);
            
            // For hard mode
            const [genYear, setGenYear] = useState('');
            const [genSem, setGenSem] = useState('');
            
            // Results tracking
            const [results, setResults] = useState({ name: null, position: null, generation: null });

            useEffect(() => {
                let data = [];
                if (type === 'trainee') {
                    data = config.filter === 'all' ? [...traineeData] : traineeData.filter(t => t.jurusan === config.filter);
                } else {
                    const all = getAllTrainers();
                    if (config.filter === 'all') data = all;
                    else if (config.filterType === 'generation') data = all.filter(t => t.generation === config.filter);
                    else if (config.filterType === 'position') data = all.filter(t => t.position === config.filter);
                    else if (config.filterType === 'subject') data = all.filter(t => t.subjects.includes(config.filter));
                }
                
                const shuffled = shuffleArray(data);
                const questionsWithOptions = shuffled.map(person => {
                    let options, positionOptions;
                    
                    if (config.mode === 'subject') {
                        const allSubjects = Object.keys(subjectMapping);
                        const correctSubject = person.subjects[0] || allSubjects[0];
                        const wrongSubjects = allSubjects.filter(s => !person.subjects.includes(s));
                        options = shuffleArray([correctSubject, ...shuffleArray(wrongSubjects).slice(0, 3)]);
                    } else {
                        const otherPeople = data.filter(p => p.name !== person.name);
                        options = shuffleArray([person.name, ...shuffleArray(otherPeople).slice(0, 3).map(p => p.name)]);
                    }
                    
                    if (type === 'trainer' && (config.mode === 'spelling' || config.mode === 'hard')) {
                        const allPositions = getUniquePositions();
                        const wrongPositions = allPositions.filter(p => p !== person.position);
                        positionOptions = shuffleArray([person.position, ...shuffleArray(wrongPositions).slice(0, 3)]);
                    }
                    
                    return { ...person, options, positionOptions };
                });
                
                setQuestions(questionsWithOptions);
                setProgress(new Array(questionsWithOptions.length).fill(null));
            }, [type, config]);

            const currentQuestion = questions[currentIndex];

            const generateHint = useCallback((name, level) => {
                const parts = name.split(' ');
                switch (level) {
                    case 1: return `First name starts with: ${parts[0][0]}...`;
                    case 2: return `First name: ${parts[0]}`;
                    case 3: return parts.map(p => p[0] + '_'.repeat(p.length - 1)).join(' ');
                    default: return '';
                }
            }, []);

            const handleMultipleChoice = (answer) => {
                if (answered) return;
                
                let correct;
                if (config.mode === 'subject') {
                    correct = currentQuestion.subjects.includes(answer);
                } else {
                    correct = answer === currentQuestion.name;
                }
                
                setSelectedAnswer(answer);
                setAnswered(true);
                setResults({ name: correct });
                
                if (correct) setScore(s => s + 10);
                setProgress(prev => { const np = [...prev]; np[currentIndex] = correct; return np; });
            };

            const handleSpellingSubmit = (e) => {
                e.preventDefault();
                if (answered) return;
                
                // For trainee - just check name
                if (type === 'trainee') {
                    const nameCorrect = normalizeText(textAnswer) === normalizeText(currentQuestion.name);
                    setAnswered(true);
                    setResults({ name: nameCorrect });
                    if (nameCorrect) setScore(s => s + 15);
                    setProgress(prev => { const np = [...prev]; np[currentIndex] = nameCorrect; return np; });
                    return;
                }
                
                // For trainer spelling mode - check name AND position
                if (config.mode === 'spelling') {
                    if (!selectedPosition) return; // Must select position
                    
                    const nameCorrect = normalizeText(textAnswer) === normalizeText(currentQuestion.name);
                    const positionCorrect = selectedPosition === currentQuestion.position;
                    const allCorrect = nameCorrect && positionCorrect;
                    
                    setAnswered(true);
                    setResults({ name: nameCorrect, position: positionCorrect });
                    if (allCorrect) setScore(s => s + 15);
                    setProgress(prev => { const np = [...prev]; np[currentIndex] = allCorrect; return np; });
                    return;
                }
                
                // For hard mode - check name, position, AND generation
                if (config.mode === 'hard') {
                    if (!selectedPosition || !genYear || !genSem) return; // Must fill all
                    
                    const nameCorrect = normalizeText(textAnswer) === normalizeText(currentQuestion.name);
                    const positionCorrect = selectedPosition === currentQuestion.position;
                    const userGen = `${genYear}-${genSem}`;
                    const genCorrect = userGen === currentQuestion.generation;
                    const allCorrect = nameCorrect && positionCorrect && genCorrect;
                    
                    setAnswered(true);
                    setResults({ name: nameCorrect, position: positionCorrect, generation: genCorrect });
                    if (allCorrect) setScore(s => s + 20);
                    setProgress(prev => { const np = [...prev]; np[currentIndex] = allCorrect; return np; });
                }
            };

            const handleNext = () => {
                if (currentIndex < questions.length - 1) {
                    setCurrentIndex(i => i + 1);
                    setAnswered(false);
                    setSelectedAnswer(null);
                    setTextAnswer('');
                    setShowHint(false);
                    setHintLevel(0);
                    setSelectedPosition(null);
                    setGenYear('');
                    setGenSem('');
                    setResults({ name: null, position: null, generation: null });
                } else {
                    onComplete({ score, total: questions.length, progress });
                }
            };

            const handleShowHint = () => { if (hintLevel < 3) { setHintLevel(h => h + 1); setShowHint(true); } };

            if (questions.length === 0) return <div style={styles.container}><p style={{ textAlign: 'center', color: 'var(--text-secondary)' }}>Loading...</p></div>;

            const progressPercent = ((currentIndex + (answered ? 1 : 0)) / questions.length) * 100;
            const isTrainerSpelling = type === 'trainer' && config.mode === 'spelling';
            const isHardMode = type === 'trainer' && config.mode === 'hard';

            // Check if submit should be enabled
            const canSubmit = () => {
                if (isHardMode) return textAnswer.trim() && selectedPosition && genYear && genSem;
                if (isTrainerSpelling) return textAnswer.trim() && selectedPosition;
                return textAnswer.trim();
            };

            return (
                <div style={styles.container} className="fade-in">
                    <button style={styles.backButton} onClick={onBack}>‚Üê Exit Quiz</button>

                    <div style={styles.scoreDisplay}>
                        <div>
                            <span style={{ fontSize: '0.75rem', color: 'var(--text-muted)' }}>SCORE</span>
                            <div style={{ fontSize: '1.25rem', fontWeight: '700', fontFamily: "'JetBrains Mono', monospace" }}>{score}</div>
                        </div>
                        <div style={{ textAlign: 'right' }}>
                            <span style={{ fontSize: '0.75rem', color: 'var(--text-muted)' }}>PROGRESS</span>
                            <div style={{ fontSize: '1.25rem', fontWeight: '700', fontFamily: "'JetBrains Mono', monospace" }}>{currentIndex + 1}/{questions.length}</div>
                        </div>
                    </div>

                    <div style={styles.progressBar}><div style={{ ...styles.progressFill, width: `${progressPercent}%` }} /></div>

                    <div style={{ display: 'flex', gap: '3px', marginBottom: '20px', flexWrap: 'wrap' }}>
                        {progress.map((p, i) => <div key={i} style={{ width: '8px', height: '8px', borderRadius: '2px', background: p === null ? 'var(--bg-tertiary)' : p ? 'var(--success)' : 'var(--error)' }} />)}
                    </div>

                    <div style={styles.card} className={answered && !progress[currentIndex] ? 'shake' : ''}>
                        <img src={currentQuestion.img} alt="Person" style={styles.personImage} onError={(e) => { e.target.src = '/Logokita.png'; }} />

                        {/* Tags display */}
                        {type === 'trainer' && !isHardMode && (
                            <div style={{ textAlign: 'center', marginBottom: '12px' }}>
                                <span style={styles.tag}>Gen {currentQuestion.generation}</span>
                                <span style={styles.tag}>{currentQuestion.initial}</span>
                            </div>
                        )}

                        {/* Hard mode: censored initial, no generation */}
                        {isHardMode && (
                            <div style={{ textAlign: 'center', marginBottom: '12px' }}>
                                <span style={{ ...styles.tag, fontFamily: "'JetBrains Mono', monospace" }}>{censorInitial(currentQuestion.initial)}</span>
                            </div>
                        )}

                        {/* Subject tags */}
                        {type === 'trainer' && currentQuestion.subjects && currentQuestion.subjects.length > 0 && config.mode !== 'subject' && (
                            <div style={{ textAlign: 'center', marginBottom: '12px' }}>
                                {currentQuestion.subjects.map(s => <span key={s} style={styles.tagSubject}>{s}</span>)}
                            </div>
                        )}

                        {type === 'trainee' && (
                            <div style={{ textAlign: 'center', marginBottom: '16px' }}>
                                <span style={styles.tag}>{currentQuestion.tnumber}</span>
                                <span style={styles.tag}>{currentQuestion.angkatan}</span>
                                <span style={styles.tag}>{currentQuestion.jurusan}</span>
                            </div>
                        )}

                        {/* Subject guess mode header */}
                        {config.mode === 'subject' && (
                            <div style={{ textAlign: 'center', marginBottom: '16px' }}>
                                <p style={{ fontSize: '1.125rem', fontWeight: '600' }}>{currentQuestion.name}</p>
                                <p style={{ color: 'var(--text-muted)', fontSize: '0.875rem', marginTop: '4px' }}>What subject do they teach?</p>
                            </div>
                        )}

                        {/* Question text for simple modes */}
                        {config.mode === 'multiple' && <p style={{ textAlign: 'center', color: 'var(--text-secondary)', marginBottom: '16px' }}>Who is this person?</p>}

                        {/* Multiple Choice Mode */}
                        {config.mode === 'multiple' && (
                            <div>
                                {currentQuestion.options.map((option, idx) => {
                                    const isOptionCorrect = option === currentQuestion.name;
                                    const isSelected = selectedAnswer === option;
                                    let buttonStyle = { ...styles.optionButton };
                                    if (answered) {
                                        if (isOptionCorrect) buttonStyle = { ...buttonStyle, borderColor: 'var(--success)', background: 'rgba(34, 197, 94, 0.1)' };
                                        else if (isSelected) buttonStyle = { ...buttonStyle, borderColor: 'var(--error)', background: 'rgba(239, 68, 68, 0.1)' };
                                    }
                                    return (
                                        <button key={idx} style={buttonStyle} onClick={() => handleMultipleChoice(option)} disabled={answered}>
                                            <span style={{ display: 'inline-flex', alignItems: 'center', justifyContent: 'center', width: '24px', height: '24px', borderRadius: '6px', background: 'var(--bg-primary)', marginRight: '12px', fontSize: '0.75rem', fontWeight: '600', flexShrink: 0 }}>{String.fromCharCode(65 + idx)}</span>
                                            <span style={{ wordBreak: 'break-word' }}>{option}</span>
                                        </button>
                                    );
                                })}
                            </div>
                        )}

                        {/* Subject Guess Mode */}
                        {config.mode === 'subject' && (
                            <div>
                                {currentQuestion.options.map((option, idx) => {
                                    const isOptionCorrect = currentQuestion.subjects.includes(option);
                                    const isSelected = selectedAnswer === option;
                                    let buttonStyle = { ...styles.optionButton };
                                    if (answered) {
                                        if (isOptionCorrect) buttonStyle = { ...buttonStyle, borderColor: 'var(--success)', background: 'rgba(34, 197, 94, 0.1)' };
                                        else if (isSelected) buttonStyle = { ...buttonStyle, borderColor: 'var(--error)', background: 'rgba(239, 68, 68, 0.1)' };
                                    }
                                    return (
                                        <button key={idx} style={buttonStyle} onClick={() => handleMultipleChoice(option)} disabled={answered}>
                                            <span style={{ display: 'inline-flex', alignItems: 'center', justifyContent: 'center', width: '24px', height: '24px', borderRadius: '6px', background: 'var(--bg-primary)', marginRight: '12px', fontSize: '0.75rem', fontWeight: '600', flexShrink: 0 }}>{String.fromCharCode(65 + idx)}</span>
                                            <span>{subjectFullNames[option]}</span>
                                        </button>
                                    );
                                })}
                            </div>
                        )}

                        {/* Trainee Spelling Mode */}
                        {type === 'trainee' && config.mode === 'spelling' && (
                            <form onSubmit={handleSpellingSubmit}>
                                <p style={{ textAlign: 'center', color: 'var(--text-secondary)', marginBottom: '12px' }}>Who is this person?</p>
                                <input type="text" style={{ ...styles.input, borderColor: answered ? (results.name ? 'var(--success)' : 'var(--error)') : 'var(--border)', marginBottom: '12px' }} placeholder="Type the full name..." value={textAnswer} onChange={(e) => setTextAnswer(e.target.value)} disabled={answered} autoComplete="off" autoCapitalize="words" />
                                {!answered && <button type="submit" style={{ ...styles.button, ...styles.buttonPrimary }} disabled={!textAnswer.trim()}>Submit Answer</button>}
                                {answered && !results.name && (
                                    <div style={{ padding: '12px', background: 'rgba(239, 68, 68, 0.1)', borderRadius: '8px' }}>
                                        <p style={{ color: 'var(--error)', fontSize: '0.875rem' }}>Correct: <strong>{currentQuestion.name}</strong></p>
                                    </div>
                                )}
                            </form>
                        )}

                        {/* Trainer Spelling + Position Mode */}
                        {isTrainerSpelling && (
                            <form onSubmit={handleSpellingSubmit}>
                                <div style={styles.sectionLabel}>üìù Type the Name</div>
                                <input type="text" style={{ ...styles.input, borderColor: answered ? (results.name ? 'var(--success)' : 'var(--error)') : 'var(--border)', marginBottom: '16px' }} placeholder="Type the full name..." value={textAnswer} onChange={(e) => setTextAnswer(e.target.value)} disabled={answered} autoComplete="off" autoCapitalize="words" />

                                <div style={styles.sectionLabel}>üíº Select Position</div>
                                <div style={{ marginBottom: '16px' }}>
                                    {currentQuestion.positionOptions && currentQuestion.positionOptions.map((pos, idx) => {
                                        const isOptionCorrect = pos === currentQuestion.position;
                                        const isSelected = selectedPosition === pos;
                                        let buttonStyle = { ...styles.optionButton, padding: '12px 14px', fontSize: '0.8125rem' };
                                        if (answered) {
                                            if (isOptionCorrect) buttonStyle = { ...buttonStyle, borderColor: 'var(--success)', background: 'rgba(34, 197, 94, 0.1)' };
                                            else if (isSelected && !isOptionCorrect) buttonStyle = { ...buttonStyle, borderColor: 'var(--error)', background: 'rgba(239, 68, 68, 0.1)' };
                                        } else if (isSelected) {
                                            buttonStyle = { ...buttonStyle, borderColor: 'var(--accent)', background: 'rgba(99, 102, 241, 0.1)' };
                                        }
                                        return (
                                            <button key={idx} type="button" style={buttonStyle} onClick={() => !answered && setSelectedPosition(pos)} disabled={answered}>
                                                <span style={{ display: 'inline-flex', alignItems: 'center', justifyContent: 'center', width: '22px', height: '22px', borderRadius: '6px', background: 'var(--bg-primary)', marginRight: '10px', fontSize: '0.7rem', fontWeight: '600', flexShrink: 0 }}>{String.fromCharCode(65 + idx)}</span>
                                                <span style={{ wordBreak: 'break-word' }}>{pos}</span>
                                            </button>
                                        );
                                    })}
                                </div>

                                {!answered && <button type="submit" style={{ ...styles.button, ...styles.buttonPrimary }} disabled={!canSubmit()}>Submit All Answers</button>}

                                {answered && (
                                    <div style={{ marginTop: '12px' }}>
                                        <div style={{ ...styles.feedbackItem, background: results.name ? 'rgba(34, 197, 94, 0.1)' : 'rgba(239, 68, 68, 0.1)' }}>
                                            <span>{results.name ? '‚úÖ' : '‚ùå'}</span>
                                            <span style={{ color: results.name ? 'var(--success)' : 'var(--error)' }}>
                                                Name: {results.name ? 'Correct' : <><span style={{ textDecoration: 'line-through', opacity: 0.6 }}>{textAnswer}</span> ‚Üí <strong>{currentQuestion.name}</strong></>}
                                            </span>
                                        </div>
                                        <div style={{ ...styles.feedbackItem, background: results.position ? 'rgba(34, 197, 94, 0.1)' : 'rgba(239, 68, 68, 0.1)' }}>
                                            <span>{results.position ? '‚úÖ' : '‚ùå'}</span>
                                            <span style={{ color: results.position ? 'var(--success)' : 'var(--error)' }}>
                                                Position: {results.position ? 'Correct' : <><span style={{ textDecoration: 'line-through', opacity: 0.6, fontSize: '0.8rem' }}>{selectedPosition}</span> ‚Üí <strong style={{ fontSize: '0.8rem' }}>{currentQuestion.position}</strong></>}
                                            </span>
                                        </div>
                                        <div style={{ textAlign: 'center', marginTop: '12px', padding: '10px', background: progress[currentIndex] ? 'rgba(34, 197, 94, 0.15)' : 'rgba(239, 68, 68, 0.15)', borderRadius: '8px' }}>
                                            <span style={{ fontSize: '1.25rem', marginRight: '8px' }}>{progress[currentIndex] ? 'üéâ' : 'üò¢'}</span>
                                            <span style={{ fontWeight: '600', color: progress[currentIndex] ? 'var(--success)' : 'var(--error)' }}>
                                                {progress[currentIndex] ? 'Perfect! +15 points' : 'Not quite - both must be correct'}
                                            </span>
                                        </div>
                                    </div>
                                )}
                            </form>
                        )}

                        {/* Hard Mode */}
                        {isHardMode && (
                            <form onSubmit={handleSpellingSubmit}>
                                <div style={styles.sectionLabel}>üìù Type the Name</div>
                                <input type="text" style={{ ...styles.input, borderColor: answered ? (results.name ? 'var(--success)' : 'var(--error)') : 'var(--border)', marginBottom: '16px' }} placeholder="Type the full name..." value={textAnswer} onChange={(e) => setTextAnswer(e.target.value)} disabled={answered} autoComplete="off" autoCapitalize="words" />

                                <div style={styles.sectionLabel}>üíº Select Position</div>
                                <div style={{ marginBottom: '16px' }}>
                                    {currentQuestion.positionOptions && currentQuestion.positionOptions.map((pos, idx) => {
                                        const isOptionCorrect = pos === currentQuestion.position;
                                        const isSelected = selectedPosition === pos;
                                        let buttonStyle = { ...styles.optionButton, padding: '12px 14px', fontSize: '0.8125rem' };
                                        if (answered) {
                                            if (isOptionCorrect) buttonStyle = { ...buttonStyle, borderColor: 'var(--success)', background: 'rgba(34, 197, 94, 0.1)' };
                                            else if (isSelected && !isOptionCorrect) buttonStyle = { ...buttonStyle, borderColor: 'var(--error)', background: 'rgba(239, 68, 68, 0.1)' };
                                        } else if (isSelected) {
                                            buttonStyle = { ...buttonStyle, borderColor: 'var(--accent)', background: 'rgba(99, 102, 241, 0.1)' };
                                        }
                                        return (
                                            <button key={idx} type="button" style={buttonStyle} onClick={() => !answered && setSelectedPosition(pos)} disabled={answered}>
                                                <span style={{ display: 'inline-flex', alignItems: 'center', justifyContent: 'center', width: '22px', height: '22px', borderRadius: '6px', background: 'var(--bg-primary)', marginRight: '10px', fontSize: '0.7rem', fontWeight: '600', flexShrink: 0 }}>{String.fromCharCode(65 + idx)}</span>
                                                <span style={{ wordBreak: 'break-word' }}>{pos}</span>
                                            </button>
                                        );
                                    })}
                                </div>

                                <div style={styles.sectionLabel}>üìÖ Guess Generation</div>
                                <div style={{ display: 'flex', alignItems: 'center', gap: '8px', marginBottom: '16px' }}>
                                    <input type="text" style={{ ...styles.inputSmall, borderColor: answered ? (results.generation ? 'var(--success)' : 'var(--error)') : 'var(--border)' }} placeholder="YY" maxLength={2} value={genYear} onChange={(e) => setGenYear(e.target.value.replace(/\D/g, ''))} disabled={answered} />
                                    <span style={{ color: 'var(--text-muted)', fontSize: '1.25rem', fontFamily: "'JetBrains Mono', monospace" }}>-</span>
                                    <input type="text" style={{ ...styles.inputSmall, width: '40px', borderColor: answered ? (results.generation ? 'var(--success)' : 'var(--error)') : 'var(--border)' }} placeholder="S" maxLength={1} value={genSem} onChange={(e) => setGenSem(e.target.value.replace(/\D/g, ''))} disabled={answered} />
                                    <span style={{ color: 'var(--text-muted)', fontSize: '0.8125rem', marginLeft: '8px' }}>(e.g., 24-1)</span>
                                </div>

                                {!answered && <button type="submit" style={{ ...styles.button, ...styles.buttonPrimary }} disabled={!canSubmit()}>Submit All Answers</button>}

                                {answered && (
                                    <div style={{ marginTop: '12px' }}>
                                        <div style={{ ...styles.feedbackItem, background: results.name ? 'rgba(34, 197, 94, 0.1)' : 'rgba(239, 68, 68, 0.1)' }}>
                                            <span>{results.name ? '‚úÖ' : '‚ùå'}</span>
                                            <span style={{ color: results.name ? 'var(--success)' : 'var(--error)' }}>
                                                Name: {results.name ? 'Correct' : <><span style={{ textDecoration: 'line-through', opacity: 0.6 }}>{textAnswer}</span> ‚Üí <strong>{currentQuestion.name}</strong></>}
                                            </span>
                                        </div>
                                        <div style={{ ...styles.feedbackItem, background: results.position ? 'rgba(34, 197, 94, 0.1)' : 'rgba(239, 68, 68, 0.1)' }}>
                                            <span>{results.position ? '‚úÖ' : '‚ùå'}</span>
                                            <span style={{ color: results.position ? 'var(--success)' : 'var(--error)', fontSize: '0.8rem' }}>
                                                Position: {results.position ? 'Correct' : <><span style={{ textDecoration: 'line-through', opacity: 0.6 }}>{selectedPosition}</span> ‚Üí <strong>{currentQuestion.position}</strong></>}
                                            </span>
                                        </div>
                                        <div style={{ ...styles.feedbackItem, background: results.generation ? 'rgba(34, 197, 94, 0.1)' : 'rgba(239, 68, 68, 0.1)' }}>
                                            <span>{results.generation ? '‚úÖ' : '‚ùå'}</span>
                                            <span style={{ color: results.generation ? 'var(--success)' : 'var(--error)' }}>
                                                Generation: {results.generation ? 'Correct' : <><span style={{ textDecoration: 'line-through', opacity: 0.6 }}>{genYear}-{genSem}</span> ‚Üí <strong>{currentQuestion.generation}</strong></>}
                                            </span>
                                        </div>
                                        <div style={{ textAlign: 'center', marginTop: '12px', padding: '10px', background: progress[currentIndex] ? 'rgba(34, 197, 94, 0.15)' : 'rgba(239, 68, 68, 0.15)', borderRadius: '8px' }}>
                                            <span style={{ fontSize: '1.25rem', marginRight: '8px' }}>{progress[currentIndex] ? 'üî•' : 'üò¢'}</span>
                                            <span style={{ fontWeight: '600', color: progress[currentIndex] ? 'var(--success)' : 'var(--error)' }}>
                                                {progress[currentIndex] ? 'Perfect! +20 points' : 'Not quite - all must be correct'}
                                            </span>
                                        </div>
                                    </div>
                                )}
                            </form>
                        )}

                        {/* Hint System */}
                        {!answered && (config.mode === 'spelling' || config.mode === 'hard' || (type === 'trainee' && config.mode === 'spelling')) && (
                            <div style={{ marginTop: '16px', textAlign: 'center' }}>
                                <button type="button" style={styles.hintButton} onClick={handleShowHint} disabled={hintLevel >= 3}>üí° Get Hint ({3 - hintLevel} left)</button>
                                {showHint && <div style={styles.hintText}>{generateHint(currentQuestion.name, hintLevel)}</div>}
                            </div>
                        )}

                        {/* Next Button for multiple choice and subject modes */}
                        {answered && (config.mode === 'multiple' || config.mode === 'subject') && (
                            <div style={{ marginTop: '16px' }}>
                                <div style={{ textAlign: 'center', marginBottom: '16px', padding: '12px', background: results.name ? 'rgba(34, 197, 94, 0.1)' : 'rgba(239, 68, 68, 0.1)', borderRadius: '8px' }}>
                                    <span style={{ fontSize: '1.5rem', marginRight: '8px' }}>{results.name ? '‚úÖ' : '‚ùå'}</span>
                                    <span style={{ color: results.name ? 'var(--success)' : 'var(--error)', fontWeight: '600' }}>{results.name ? 'Correct!' : 'Incorrect'}</span>
                                    {config.mode === 'subject' && !results.name && currentQuestion.subjects.length > 0 && (
                                        <div style={{ marginTop: '8px', fontSize: '0.875rem', color: 'var(--text-secondary)' }}>Correct: {currentQuestion.subjects.map(s => subjectFullNames[s]).join(', ')}</div>
                                    )}
                                </div>
                                <button style={{ ...styles.button, ...styles.buttonPrimary }} onClick={handleNext}>{currentIndex < questions.length - 1 ? 'Next Question' : 'See Results'} <span>‚Üí</span></button>
                            </div>
                        )}

                        {/* Next Button for spelling modes */}
                        {answered && (isTrainerSpelling || isHardMode || (type === 'trainee' && config.mode === 'spelling')) && (
                            <div style={{ marginTop: '16px' }}>
                                <button style={{ ...styles.button, ...styles.buttonPrimary }} onClick={handleNext}>{currentIndex < questions.length - 1 ? 'Next Question' : 'See Results'} <span>‚Üí</span></button>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const ResultsScreen = ({ results, onRestart, onHome }) => {
            const percentage = Math.round((results.progress.filter(p => p === true).length / results.total) * 100);
            const correctCount = results.progress.filter(p => p === true).length;
            
            let emoji, message;
            if (percentage >= 90) { emoji = 'üèÜ'; message = 'Outstanding! You have excellent memory!'; }
            else if (percentage >= 70) { emoji = 'üåü'; message = 'Great job! Keep practicing!'; }
            else if (percentage >= 50) { emoji = 'üí™'; message = 'Good effort! Room for improvement.'; }
            else { emoji = 'üìö'; message = 'Keep studying! Practice makes perfect.'; }

            return (
                <div style={styles.container} className="fade-in">
                    <div style={{ ...styles.card, ...styles.resultCard }}>
                        <div style={styles.resultIcon}>{emoji}</div>
                        <h2 style={{ fontSize: '1.5rem', fontWeight: '700', marginBottom: '8px' }}>Quiz Complete!</h2>
                        <p style={{ color: 'var(--text-secondary)', marginBottom: '24px' }}>{message}</p>
                        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: '16px', marginBottom: '24px' }}>
                            <div style={{ padding: '16px', background: 'var(--bg-tertiary)', borderRadius: '12px' }}>
                                <div style={{ fontSize: '1.5rem', fontWeight: '700', color: 'var(--accent)', fontFamily: "'JetBrains Mono', monospace" }}>{results.score}</div>
                                <div style={{ fontSize: '0.75rem', color: 'var(--text-muted)', marginTop: '4px' }}>SCORE</div>
                            </div>
                            <div style={{ padding: '16px', background: 'var(--bg-tertiary)', borderRadius: '12px' }}>
                                <div style={{ fontSize: '1.5rem', fontWeight: '700', color: 'var(--success)', fontFamily: "'JetBrains Mono', monospace" }}>{correctCount}/{results.total}</div>
                                <div style={{ fontSize: '0.75rem', color: 'var(--text-muted)', marginTop: '4px' }}>CORRECT</div>
                            </div>
                            <div style={{ padding: '16px', background: 'var(--bg-tertiary)', borderRadius: '12px' }}>
                                <div style={{ fontSize: '1.5rem', fontWeight: '700', color: 'var(--warning)', fontFamily: "'JetBrains Mono', monospace" }}>{percentage}%</div>
                                <div style={{ fontSize: '0.75rem', color: 'var(--text-muted)', marginTop: '4px' }}>ACCURACY</div>
                            </div>
                        </div>
                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '4px', justifyContent: 'center', marginBottom: '24px' }}>
                            {results.progress.map((p, i) => <div key={i} style={{ width: '12px', height: '12px', borderRadius: '3px', background: p ? 'var(--success)' : 'var(--error)' }} title={`Question ${i + 1}: ${p ? 'Correct' : 'Incorrect'}`} />)}
                        </div>
                        <button style={{ ...styles.button, ...styles.buttonPrimary, marginBottom: '8px' }} onClick={onRestart}>Try Again <span>üîÑ</span></button>
                        <button style={styles.button} onClick={onHome}>Back to Home <span>üè†</span></button>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [screen, setScreen] = useState('home');
            const [quizType, setQuizType] = useState(null);
            const [quizConfig, setQuizConfig] = useState(null);
            const [results, setResults] = useState(null);

            const handleSelectMode = (mode) => { setQuizType(mode); setScreen(mode === 'trainee' ? 'trainee-setup' : 'trainer-setup'); };
            const handleStartQuiz = (config) => { setQuizConfig(config); setScreen('quiz'); };
            const handleQuizComplete = (quizResults) => { setResults(quizResults); setScreen('results'); };
            const handleRestart = () => { setScreen('quiz'); };
            const handleHome = () => { setScreen('home'); setQuizType(null); setQuizConfig(null); setResults(null); };

            switch (screen) {
                case 'home': return <HomeScreen onSelectMode={handleSelectMode} />;
                case 'trainee-setup': return <TraineeSetupScreen onBack={handleHome} onStart={handleStartQuiz} />;
                case 'trainer-setup': return <TrainerSetupScreen onBack={handleHome} onStart={handleStartQuiz} />;
                case 'quiz': return <QuizScreen type={quizType} config={quizConfig} onBack={handleHome} onComplete={handleQuizComplete} />;
                case 'results': return <ResultsScreen results={results} onRestart={handleRestart} onHome={handleHome} />;
                default: return <HomeScreen onSelectMode={handleSelectMode} />;
            }
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>